<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="./redux-store/redux-store.html">
<link rel="import" href="../bower_components/vaadin-split-layout/vaadin-split-layout.html">
<link rel="import" href="./friends/friend-list.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-progress/paper-progress.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid-sorter.html">
<link rel="import" href="../bower_components/vaadin-grid/vaadin-grid-filter.html">
<link rel="import" href="./shared-styles.html">
<link rel="import" href="./friends/friend-signup.html">

<dom-module id="my-view1">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
      }
      
      iron-pages {
        padding: .5em;
      }

      .smart-panel-selected {
        max-width:40%;
        min-width:350px;
        width:40%;

      }

      .smart-panel-not-selected {
        max-width:0%;
        min-width:0px;
        width:0px;
      }

      vaadin-grid {
        border: 0px;
      }

      paper-icon-button {
        --paper-icon-button-ink-color : var(--primary-text-color);
      }
    </style>

    <iron-ajax
      id="getIt"
      url="https://randomuser.me/api/"
      handle-as="json"
      on-response="_handleResponse"
      debounce-duration="300"
      loading="{{loading}}">
    </iron-ajax>

    <vaadin-split-layout id="layout">
      <div>
        <app-toolbar>
          <div main-title>Friends List</div>
          <friend-signup></friend-signup>
        </app-toolbar>
        
        <vaadin-grid 
          aria-label="Selection using Active Item Example" 
          id="grid" 
          items="[[friends]]"
          active-item="{{activeItem}}" 
          size="200">

          <vaadin-grid-column>
            <template class="header">
              <vaadin-grid-sorter path="person.name.first">
                <vaadin-grid-filter 
                  aria-label="First Name" 
                  path="person.name.first" 
                  value="[[_filterFirstName]]">
                  <input 
                    id="firstnamefilter"
                    class="filter-header" 
                    slot="filter" 
                    placeholder="First Name" 
                    value="{{_filterFirstName::input}}" 
                    focus-target>                  
                </vaadin-grid-filter>
                <template is="dom-if" if="[[_filterFirstName]]">
                  <paper-icon-button 
                    icon="clear" 
                    input="firstnamefilter"
                    on-click="_clearSearch">
                  </paper-icon-button>
                </template>
              </vaadin-grid-sorter>              
            </template>
            <template>[[item.person.name.first]]</template>
          </vaadin-grid-column>

          <vaadin-grid-column>
            <template class="header">
              <vaadin-grid-sorter path="person.name.last">
                <vaadin-grid-filter 
                  aria-label="Last Name" 
                  path="person.name.last" 
                  value="[[_filterLastName]]">
                  <input
                    id="lastnamefilter" 
                    class="filter-header" 
                    slot="filter" 
                    placeholder="Last Name" 
                    value="{{_filterLastName::input}}" 
                    focus-target>                  
                </vaadin-grid-filter>
                <template is="dom-if" if="[[_filterLastName]]">
                  <paper-icon-button 
                    icon="clear" 
                    input="lastnamefilter"
                    on-click="_clearSearch">
                  </paper-icon-button>
                </template>
              </vaadin-grid-sorter>              
            </template>
            <template>[[item.person.name.last]]</template>
          </vaadin-grid-column>

        </vaadin-grid>
      </div>
            
      <div class$="smart-panel [[panelClass]]" style="">
        <template is="dom-if" if="[[loading]]">
          <paper-progress indeterminate class="green" style="width:100%;"></paper-progress>
        </template>
        <template is="dom-if" if="[[selectedFriend]]">
          <div class="card">
            <div class="container flex-center-justified">
              <img src="[[selectedFriend.picture.large]]" alt="" style="border-radius:50%;">
            </div>
            <h2 style="text-align:center;">[[selectedFriend.name.first]] [[selectedFriend.name.last]]</h2>
            <paper-tabs selected="{{selected}}">
              <paper-tab>Details</paper-tab>
              <paper-tab>Friends List</paper-tab>
            </paper-tabs>

            <iron-pages selected="{{selected}}">
              <div>
                <paper-input label="Phone" value="[[selectedFriend.phone]]"></paper-input>
                <paper-input label="Cell" value="[[selectedFriend.cell]]"></paper-input>
                <paper-input label="Email Address" value="[[selectedFriend.email]]"></paper-input>
                <paper-input label="Street" value="[[selectedFriend.location.street]]"></paper-input>
                <paper-input label="City" value="[[selectedFriend.location.city]]"></paper-input>
                <paper-input label="State" value="[[selectedFriend.location.state]]"></paper-input>
              </div>
              <div>
                <friend-list></friend-list>
              </div>
            </iron-pages>

          </div>
          
        </template> 
      </div>
    </vaadin-split-layout>
  </template>

  <script>
    class MyView2 extends ReduxMixin( Polymer.Element ) {
      static get is( ) { return 'my-view1'; }

      static get properties( ) {
        return {
          friends     : {
            type      : Array,
            statePath : 'friends' //polymer-redux association to state
          },
          
          activeItem: {
            observer: '_activeItemChanged'
          }
        }
      }

      ready( ) {
        super.ready( );   
        this.selected   = 0;
        window.addEventListener( 'resize', ( ) => {
          this._sizeContent( );
        } );
      }

      connectedCallback( ) {
        super.connectedCallback( );
        this._sizeContent( );
      }

      _activeItemChanged( item ) {
        this.$.grid.selectedItems = item ? [ item ] : [ ];

        if( item !== null ) {
          this.$.getIt.generateRequest( );
          this.panelClass = "smart-panel-selected";
        } else {
          this.selectedFriend = null;
          this.panelClass     = "smart-panel-not-selected";
        }        
      }

      _sizeContent( ) {
        this.$.layout.style.height = ( window.innerHeight - 64 )  + "px";
        this.$.grid.style.height   = ( window.innerHeight - 128 ) + "px";
      }

      _handleResponse( res ) {
        //this.selectedFriend = res.detail.response.results[ 0 ];
        this.selectedFriend = this.$.grid.selectedItems[ 0 ].person;
      }

      _clearSearch( e ) {
        let elem   = this.shadowRoot.querySelector( '#' + e.target.attributes.input.value );
        elem.value = "";
        elem.focus( );
      }
    }

    window.customElements.define( MyView2.is, MyView2 );
  </script>
</dom-module>
