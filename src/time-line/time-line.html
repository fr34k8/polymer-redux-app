<!-- import polymer-element -->
<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<dom-module id="time-line">
  <template>
    <style>
      ul {
        list-style-type: none;
        padding: 0px;
        margin-left: 1em;
        margin-right: 1em;
      }

      h4 {
        margin: 0px;
      }

      li {
        border: solid 1px #E8E8E8;
        padding: 10px;
        border-radius: 5px;
        margin-bottom: 5px;
      }

      li:nth-child(odd) {
        background-color: #E9E9E9;
      }

      .flex-horizontal {
        @apply --layout-horizontal;
      }

      .flexchild {
        @apply --layout-flex;
      }

      hr {
        margin: 11px;
      }
    </style>
    <template is="dom-repeat" items="[[timeline]]" as="day">
      <div class="container flex-horizontal">
        <div class="flexchild"><hr/></div>
        <div>[[day.when]] ([[day.events.length]] events)</div>
        <div class="flexchild"><hr/></div>
      </div>
      
      
      <ul>
        <template is="dom-repeat" items="[[day.events]]" as="event">
          <li>
            <h4>[[event.who]] ([[event.when]])</h4>
            [[event.what]]
          </li>
        </template>
      </ul>
    </template>
  </template>

  <script>
    class TimeLine extends Polymer.Element {
      static get is( ) { return "time-line"; }

      static get properties( ) {
        return {
          history : {
            type  : Array
          }
        };
      }

      constructor( ) {
        super( );
      }

      ready( ) {
        super.ready( );
        this.timeline = [ ];

        this.history.map( ( event ) => {
          let it = this.timeline.filter( function( obj ) {
            return obj.when === event.when;
          } )[ 0 ];

          if( it ) {
            it.events.push( event );
          } else {
            this.timeline.push( { when : event.when, events : [ event ]  } );
          }
          
        } );

        this.timeline.sort( ( a, b ) => {
          var c = new Date( a.when );
          var d = new Date( b.when );
          return c - d;
        } );

        console.log( this.timeline );
      }

    }

    customElements.define( TimeLine.is, TimeLine );
  </script>
</dom-module>